(function(a,b){function c(f,e){this.list=a(f);this.items=this.list.children();this.settings=e;this.position=0;this.active_id=b;this.lock=false;var d=this;this.items.addClass("esb-item");this.markup=a('<div class="esb"></div>');this.markup.append('<div class="esb-container container"></div>');if(this.settings.navigation){this.markup.addClass("esb-has-navigation");a('<div class="esb-navigation"></div>').append('<a class="esb-prev" href="#">'+this.settings.prevText+"</a>").append('<a class="esb-next" href="#">'+this.settings.nextText+"</a>").appendTo(this.markup)}
this.markup.append('<a class="esb-close" href="#">'+this.settings.closeText+"</a>");if(this.settings.placement==="after"){this.list.after(this.markup)}else{if(this.settings.placement==="inside"){this.markup.css({position:"absolute",top:0,left:0});a("body").append(this.markup)}else{if(/^#\w/.test(this.settings.placement)){a(this.settings.placement).append(this.markup);this.settings.placement="element"}else{this.list.before(this.markup);this.settings.placement="before"}}}
if(this.settings.id){this.markup.attr("id",this.settings.id)}
this.markup.addClass("esb-placement-"+this.settings.placement);if(this.settings.theme){this.markup.addClass("esb-theme-"+this.settings.theme)}
this.items.find(this.settings.expandLink).click(function(){d.page_scroll=a(window).scrollTop();var g=a(this).closest(".esb-item");d.expand(g);return false});this.markup.find(".esb-close").click(function(){d.collapse();return false});this.markup.find(".esb-prev").click(function(){if(!d.lock&&d.position>0){d.position--;d.expand(d.items.eq(d.position))}
return false}).end().find(".esb-next").click(function(){if(!d.lock&&d.position<d.items.length-1){d.position++;d.expand(d.items.eq(d.position))}
return false});a(window).bind("resize orientationchange",function(g){if(g.target===d.markup.get(0)){g.stopImmediatePropagation()}
if(d.settings.placement==="inside"&&/^(smart)?resize$/.test(g.type)){d.insideHideViewport()}
if(!d.temp){d.temp=[d.settings.syncScroll,d.settings.scrollPage]}
d.settings.syncScroll=true;d.settings.scrollPage=false;clearTimeout(d.resize_timer);d.resize_timer=setTimeout(function(){d.expandViewport(d.active_id,true);d.settings.syncScroll=d.temp[0];d.settings.scrollPage=d.temp[1];delete d.temp},200)});this.api={expand:function(g){d.expand(d.items.eq(g))},collapse:function(){d.collapse()},excludeHidden:function(){d.items=d.list.children(":not("+d.settings.hiddenItems+")");d.position=d.items.index(d.list.find(".esb-active-item"));if(d.settings.placement==="inside"){d.insideHideViewport()}}};this.list.data("esb",this.api);this.list.bind("esb",function(g,i,h){if(d.api.hasOwnProperty(i)){d.api[i](h)}})}
c.prototype.expand=function(f){var e=f.data("content");if(this.lock||!e){return}
this.lock=true;this.position=this.items.index(f);if(this.settings.placement==="inside"){this.insidePositionViewport(f)}
var d=f.data("esb-content-id");if(d){this.expandViewport(d)}else{this.loadContent(e,function(g){f.data("esb-content-id",g);this.expandViewport(g)})}
this.markup.find(".esb-navigation a").removeClass("esb-no-prev esb-no-next");if(this.position===0){this.markup.find(".esb-prev").addClass("esb-no-prev")}
if(this.position===this.items.length-1){this.markup.find(".esb-next").addClass("esb-no-next")}
this.items.removeClass("esb-active-item");f.addClass("esb-active-item")};c.prototype.loadContent=function(g,i){var d=this;var h=function(k){k=a(k);if(d.settings.contentFilter){k=k.filter(d.settings.contentFilter);if(k.length===0){k=k.end().find(d.settings.contentFilter)}}
var j="esb_"+Math.floor(Math.random()*100000);a('<div id="'+j+'" class="esb-content"></div>').append(k).appendTo(d.markup.find(".esb-container"));if(typeof d.settings.onContent==="function"){d.settings.onContent.call(d.markup.get(0),d.markup.find("#"+j).get(0))}
return j};if(/^#\w/.test(g)){var f=a(g).html();var e=h(f);setTimeout(function(){i.call(d,e)},20)}else{if(/(^\.{0,2}\/+\w)|(^https?:\/\/\w)/.test(g)){a.get(g,function(j){i.call(d,h(j))})}else{var e=h(g);setTimeout(function(){i.call(d,e)},20)}}};c.prototype.expandViewport=function(d,i){var h=this.settings.expandDuration,j=this.settings.expandEasing,e=this.settings.syncScroll,g=this.markup.offset().top-parseInt(this.settings.scrollOffset,10),f=this.getViewportHeight(d);if(f===0||(!i&&d===this.active_id)){this.lock=false;return}
if(this.settings.placement==="inside"){this.insideMakeGap(this.items.eq(this.position))}
this.switchContent(d);this.markup.stop().animate({height:f},h,j,a.proxy(function(){this.markup.addClass("esb-expanded");this.scroll(g,!e);this.lock=false;if(typeof this.settings.onExpand==="function"){this.settings.onExpand.call(this.markup.get(0),d)}},this));this.scroll(g,e)};c.prototype.switchContent=function(d){var e=this.markup.find("#"+this.active_id),f=this.markup.find("#"+d);if(this.active_id===d){return}
if(e.length){e.stop().fadeOut(this.settings.contentFadeOut,a.proxy(function(){f.fadeIn(this.settings.contentFadeIn)},this))}else{f.delay(this.settings.contentDelay).fadeIn(this.settings.contentFadeIn)}
this.active_id=d};c.prototype.getViewportHeight=function(f){var e=this.markup.find(".esb-container"),i=e.width(),g=e.outerHeight()-e.height()+55,h=this.markup.find("#"+f),d=0;if(h.is(":visible")){d=h.height()}else{h.css({display:"block",position:"absolute",visibility:"hidden",width:i});d=h.height();h.css({display:"",position:"",visibility:"",width:""})}
return d>0?d+g:0};c.prototype.scroll=function(f,d){var e=this.settings.scrollDuration,g=this.settings.scrollEasing;if(!this.settings.scrollPage){return}
if(d){a("body, html").stop().animate({scrollTop:f},e,g)}};c.prototype.collapse=function(){var e=this.settings.collapseDuration,f=this.settings.collapseEasing,d=this.settings.syncScroll;this.position=b;this.markup.stop().animate({height:0},e,f,a.proxy(function(){this.markup.find(".esb-content:visible").hide();this.items.removeClass("esb-active-item");this.scroll(this.page_scroll,!d);if(typeof this.settings.onCollapse==="function"){this.settings.onCollapse.call(this.markup.get(0),this.active_id)}
this.active_id=b},this));this.markup.removeClass("esb-expanded");if(this.settings.placement==="inside"){this.insideJoinGap()}
this.scroll(this.page_scroll,d)};c.prototype.insideBottomItems=function(f){var e=Math.floor(this.list.width()/f.outerWidth(true));e=Math.max(1,e);var d=Math.ceil(this.items.length/e),g=Math.floor(this.items.index(f)/e);if(g<d-1){g=g+1}
return this.items.slice(g*e)};c.prototype.insideMakeGap=function(e){var g=this.settings.expandDuration,i=this.settings.expandEasing;var d=e.data("esb-content-id");var f=this.getViewportHeight(d);f+=parseFloat(this.markup.css("margin-bottom"));a.each(this.insideBottomItems(e),function(){var j=a(this).data("esb-item-top");if(j===b){j=parseFloat(a(this).css("top"))||0;a(this).data("esb-item-top",j)}
a(this).addClass("esb-bottom-item");a(this).stop().animate({top:j+f},g,i)});var h=this.list.data("esb-list-height");if(h===b){h=this.list.height();this.list.data("esb-list-height",h)}
this.list.height(h+f)};c.prototype.insideJoinGap=function(d){var e=this.settings.collapseDuration,g=this.settings.collapseEasing;this.items.filter(".esb-bottom-item").each(function(){var h=a(this).data("esb-item-top")||0;if(d){a(this).css("top",h)}else{a(this).stop().animate({top:h},e,g)}
a(this).removeData("esb-item-top").removeClass("esb-bottom-item")});var f=this.list.data("esb-list-height");this.list.addClass("no-transition").height(f);this.list.get(0).offsetHeight;this.list.removeClass("no-transition").removeData("esb-list-height")};c.prototype.insidePositionViewport=function(g){var h=this.insideBottomItems(g);if(this.active_id){var k=this.items.filter(".esb-bottom-item");if(k.length!==h.length){this.insideHideViewport();this.insidePositionViewport(g)}}else{if(/absolute|relative/.test(this.items.eq(0).css("position"))===false){this.items.css({position:"relative",top:0,left:0})}
var e=parseFloat(this.markup.css("margin-left")),f=parseFloat(this.markup.css("margin-right")),j=this.list.offset().left+e,i=this.list.width()-(e+f),d=h.offset().top;this.markup.css({top:d})}};c.prototype.insideHideViewport=function(){if(this.active_id===b){return}
this.insideJoinGap(true);this.markup.height(0).find(".esb-content:visible").hide();this.items.removeClass("esb-active-item");this.markup.removeClass("esb-expanded");if(typeof this.settings.onCollapse==="function"){this.settings.onCollapse.call(this.markup.get(0),this.active_id)}
this.active_id=b};a.fn.esb=function(e){var d=a.extend({id:"esb",theme:"",placement:"before",expandLink:".esb-link",expandDuration:500,expandEasing:"swing",collapseDuration:300,collapseEasing:"swing",scrollPage:true,syncScroll:false,scrollDuration:300,scrollEasing:"swing",scrollOffset:10,contentFadeIn:500,contentFadeOut:200,contentDelay:200,navigation:true,closeText:"<i class='fa fa-close changesanimate'></i>",nextText:"<i class='fa fa-angle-right'></i>",prevText:"<i class='fa fa-angle-left'></i>",contentFilter:"",hiddenItems:".hidden",onExpand:function(){},onCollapse:function(){},onContent:function(){}},e);return this.each(function(){var f=new c(this,d)})}})(jQuery);